//bibliotecas
#include <FirebaseESP8266.h>
#include <ESP8266WiFi.h>
#include <DHT.h>

//parametros das funções
#define FIREBASE_HOST "pap2020-8183b.firebaseio.com"
#define FIREBASE_AUTH "vb63xs9WJTOGoGfiSWrB9GYL0IS90VSP0TXKXOO9"
#define WIFI_SSID "TP-Link_Extender"
#define WIFI_PASSWORD ""

//pinos
#define FOG        D3
#define MOV        D6
#define RELE1      D0
#define RELE2      D1
#define RELE3      D2
#define RELE4      D5
#define DHTPIN     D7 
#define FUM        D4   
#define DHTTYPE    DHT11


DHT dht(DHTPIN, DHTTYPE);


//ojectos da firebase

FirebaseData firebaseData;
FirebaseData reles;

FirebaseJson json;

int manContData[9];

void setup() {

pinMode(RELE1,OUTPUT);
pinMode(RELE2,OUTPUT);
pinMode(RELE3,OUTPUT);
pinMode(RELE4,OUTPUT);
pinMode(RELE4,OUTPUT);
pinMode(MOV,INPUT);
pinMode(FUM,INPUT);
pinMode(FOG,INPUT);

   dht.begin();
  Serial.begin(9600);
 // Serial.setTimeout(20);
  // connect to wifi.

  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
   Serial.print("connecting");
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print(".");
    delay(500);
  }
  Serial.println();
  Serial.print("connected: ");
  Serial.println(WiFi.localIP());
  Firebase.begin(FIREBASE_HOST, FIREBASE_AUTH);
  Firebase.reconnectWiFi(true);
 
}



void loop() {

float h = dht.readHumidity();
  
  float t = dht.readTemperature();
 
  float f = dht.readTemperature(true);
  
  int al  = digitalRead(FOG);

  int mo  = digitalRead(MOV);

  int fum = digitalRead(FUM);

  

  Serial.print(F("Humidity: "));
  Serial.print(h);
  Serial.print(F("%  Temperature: "));
  Serial.print(t);
  Serial.print(F("C  ,"));
  Serial.print(f);
  Serial.println(F("F  "));

  if (Firebase.setFloat(firebaseData, "Temperatura", t))
  {
    Serial.println("Temperatura enviada");
  }
  else
  {
    Serial.println("Temperatura falhou");
    Serial.println("razão: " + firebaseData.errorReason());
    Serial.println("------------------------------------");
    Serial.println();
  }

  if (Firebase.setFloat(firebaseData, "Humidade", h))
  {
    Serial.println("humidade enviada");
   
  }
  else
  {
    Serial.println("Humidade falhou");
    Serial.println("razão: " + firebaseData.errorReason());
    Serial.println("------------------------------------");
    Serial.println();
  }
   if (Firebase.setFloat(firebaseData, "Alarme", al))
  {
    Serial.println("fogo enviado");
   
  }
  else
  {
    Serial.println("Alarme falhou");
    Serial.println("razão: " + firebaseData.errorReason());
    Serial.println("------------------------------------");
    Serial.println();
  }

  if (Firebase.setFloat(firebaseData, "Movimento", mo))
  {
    Serial.println("Movimento enviado");
   
  }
  else
  {
    Serial.println("Movimento falhou");
    Serial.println("razão: " + firebaseData.errorReason());
    Serial.println("------------------------------------");
    Serial.println();
  }

   if (Firebase.setFloat(firebaseData, "Fumo", fum))
  {
    Serial.println("Fumo enviado");
   
  }
  else
  {
    Serial.println("Fumo falhou");
    Serial.println("razão: " + firebaseData.errorReason());
    Serial.println("------------------------------------");
    Serial.println();
  }
 
  if (Firebase.getString(reles, "Luz1")) {

    if (reles.dataType() == "string") {
      Serial.println(reles.stringData());
       if (reles.stringData() == "1") {
         digitalWrite(RELE1, LOW);
       }
        else if (reles.stringData() == "0"){
       digitalWrite(RELE1, HIGH);
        }
    }

  } else {
    Serial.println(reles.errorReason());
  }     

 
if (Firebase.getString(reles, "Luz2")) {

    if (reles.dataType() == "string") {
      Serial.println(reles.stringData());
       if (reles.stringData() == "1") {
         digitalWrite(RELE2, LOW);
       }
        else if (reles.stringData() == "0"){
       digitalWrite(RELE2, HIGH);
        }
    }

  } else {
    Serial.println(reles.errorReason());
  }     

 
 if (Firebase.getString(reles, "Luz3")) {

    if (reles.dataType() == "string") {
      Serial.println(reles.stringData());
       if (reles.stringData() == "1") {
         digitalWrite(RELE3, LOW);
       }
        else if (reles.stringData() == "0"){
       digitalWrite(RELE3, HIGH);
        }
    }

  } else {
    Serial.println(reles.errorReason());
  }     



  if (Firebase.getString(reles, "Luz4")) {

    if (reles.dataType() == "string") {
      Serial.println(reles.stringData());
       if (reles.stringData() == "1") {
         digitalWrite(RELE4, LOW);
       }
        else if (reles.stringData() == "0"){
       digitalWrite(RELE4, HIGH);
        }
    }

  } else {
    Serial.println(reles.errorReason());
  }     
  

}


  
  
